<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Evoluci√≥n</title>
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    input { width: 100%; box-sizing: border-box; }
    button { margin-top: 15px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Calculadora Evoluci√≥n</h2>
  <div id="status"></div>
  <table id="data-table"></table>
  <button onclick="guardarCambios()">Guardar Cambios</button>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxtx9ptZ42Tutmr7tBEYjH9_vIuNTiddEASrjQAt6_8S5YLZG0TEK6YrNluivOT_QK9/exec"; // üîÅ Reemplaza esto con tu URL

    let originalData = [];
    let inputsMap = [];

    // Leer datos desde la hoja
    fetch(API_URL)
      .then(res => res.json())
      .then(data => {
        originalData = data;
        const table = document.getElementById("data-table");

        data.forEach((row, rowIndex) => {
          const tr = document.createElement("tr");
          inputsMap[rowIndex] = [];

          row.forEach((cell, colIndex) => {
            const td = document.createElement("td");

            // Fila de encabezado
            if (rowIndex === 0) {
              td.innerHTML = `<strong>${cell}</strong>`;
            }
            // Hacer editables solo columna 2 y 3 (index 1 y 2)
            else if (colIndex === 1 || colIndex === 2) {
              const input = document.createElement("input");
              input.value = cell;
              td.appendChild(input);
              inputsMap[rowIndex][colIndex] = input;
            } else {
              td.textContent = cell;
            }

            tr.appendChild(td);
          });

          table.appendChild(tr);
        });
      });

    function guardarCambios() {
      const cambios = [];

      for (let row = 1; row < inputsMap.length; row++) {
        for (let col = 0; col < inputsMap[row].length; col++) {
          const input = inputsMap[row][col];
          if (input) {
            const nuevoValor = input.value;
            const valorOriginal = originalData[row][col];
            if (nuevoValor !== valorOriginal) {
              cambios.push({ row: row + 1, col: col + 1, value: nuevoValor });
            }
          }
        }
      }

      if (cambios.length === 0) {
        document.getElementById("status").textContent = "No hay cambios para guardar.";
        return;
      }

      fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(cambios)
      })
      .then(res => res.json())
      .then(result => {
        if (result.status === "ok") {
          document.getElementById("status").textContent = "Cambios guardados correctamente.";
        } else {
          document.getElementById("status").textContent = "Error al guardar cambios: " + result.message;
        }
      })
      .catch(err => {
        document.getElementById("status").textContent = "Error de red: " + err.message;
      });
    }
  </script>
</body>
</html>
