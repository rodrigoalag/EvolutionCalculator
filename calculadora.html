<!DOCTYPE html>
<html lang="es" id="htmlLang">
<head>
  <meta charset="UTF-8" />
  <title id="pageTitle">Calculadora de Evoluci√≥n Digimon</title>
  <link rel="icon" type="image/png" href="icon/digitamafivicon.png"/>

  <!-- ‚úÖ Estilo de simple.css -->
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.css">
<style>
	#languageSelector {
	  float: none;              /* quitar float */
	  display: inline-flex;     /* inline-flex para que no ocupe todo el ancho */
	  justify-content: center;  /* centrar contenido interno */
	  align-items: center;      /* centrar vertical */
	  margin: 0 auto;           /* centrar el bloque */
	  width: auto;              /* ancho autom√°tico, no 100% */
	}
    
    nav a {
      margin-right: 10px;
    }
    
/* Ajustar el ancho de las columnas de la tabla editable */
	#editableFieldsTable,
	#editableFieldsTable2,
	#editableFieldsTable3 {
	  width: 100%;
	  margin-bottom: 0px;
	}
    #editableFieldsTable th,
    #editableFieldsTable td,
    #editableFieldsTable2 th,
    #editableFieldsTable2 td,
    #editableFieldsTable3 th,
    #editableFieldsTable3 td {
      padding: 10px 8px;
      text-align: center;
      font-size: 16px;
    }
    #editableFieldsTable th,
    #editableFieldsTable2 th,
    #editableFieldsTable3 th {
      font-weight: bold;
    }
    /* Tabla de datos del digimon tambi√©n m√°s compacta */
    #autoFieldsTable {
      width: 100%;
      margin-bottom: 20px;
    }
    #autoFieldsTable th,
    #autoFieldsTable td {
      padding: 10px 8px;
      text-align: center;
      font-size: 16px; /* Mantener consistencia */
    }
    #autoFieldsTable th {
      font-weight: bold;
    }

    /* ====================== ESTILOS PARA HELP POPUP ====================== */
    /* Estilos para el icono de ayuda */
    .help-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      background-color: #007bff;
      color: white;
      border-radius: 50%;
      text-align: center;
      font-size: 12px;
      line-height: 16px;
      cursor: pointer;
      margin-left: 5px;
      user-select: none;
      vertical-align: middle;
    }

    .help-icon:hover {
      background-color: #0056b3;
    }

    /* Overlay del popup */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: 10000;
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .popup-overlay.show {
      display: flex;
    }

    /* Contenedor del popup */
    .popup-container {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      animation: popupIn 0.3s ease-out;
    }

    /* Animaci√≥n de entrada */
    @keyframes popupIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Bot√≥n de cerrar */
    .popup-close {
      position: absolute;
      top: 10px;
      right: 15px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      z-index: 10001;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .popup-close:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    /* Imagen del popup */
    .popup-image {
      width: 100%;
      height: auto;
      display: block;
      max-height: 80vh;
      object-fit: contain;
    }
    /* ====================== FIN ESTILOS HELP POPUP ====================== */

    /* Contenedor de la tabla editable - centrado como autoFieldsTable */
    .table-container {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      overflow-x: auto;
    }

    /* Contenedor de resultados - tabla simple centrada */
    #resultados {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      overflow-x: auto;
    }

    /* Contenedor de tabla completa - ancho completo del viewport */
    #resultadosCompletos {
      width: 100vw;
      max-width: 100vw;
      margin-left: calc(-50vw + 50%);
      margin-right: calc(-50vw + 50%);
      overflow-x: auto;
      padding: 0 20px;
      box-sizing: border-box;
      display: none; /* Oculto por defecto */
    }

    /* Tabla dentro de resultados */
    #resultados table {
      width: 100%;
      table-layout: auto;
    }

    /* Texto de evoluci√≥n */
    #evolucionTexto {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
    }

    /* Responsive: en pantallas peque√±as permitir scroll horizontal */
    @media (max-width: 768px) {
      #editableFieldsTable th,
      #editableFieldsTable td,
      #editableFieldsTable2 th,
      #editableFieldsTable2 td,
      #editableFieldsTable3 th,
      #editableFieldsTable3 td {
        font-size: 12px; /* Reducir solo en m√≥vil */
        padding: 4px 2px;
      }

      #editableFieldsTable input,
      #editableFieldsTable select,
      #editableFieldsTable2 input,
      #editableFieldsTable2 select,
      #editableFieldsTable3 input,
      #editableFieldsTable3 select {
        font-size: 11px;
      }

      .table-container {
        overflow-x: auto; /* Permitir scroll en m√≥vil si es necesario */
      }
      
      #languageSelector {
        float: none;
        display: block;
        margin: 10px auto;
      }

      /* Help popup responsive */
      .popup-container {
        max-width: 95vw;
        max-height: 85vh;
      }
      
      .popup-close {
        width: 35px;
        height: 35px;
        font-size: 20px;
        top: 5px;
        right: 10px;
      }

      .help-icon {
        width: 18px;
        height: 18px;
        line-height: 18px;
        font-size: 13px;
      }
    }
    
    @media (max-width: 480px) {
      #editableFieldsTable th,
      #editableFieldsTable td,
      #editableFieldsTable2 th,
      #editableFieldsTable2 td,
      #editableFieldsTable3 th,
      #editableFieldsTable3 td {
        font-size: 12px;
        padding: 4px 2px;
      }

      #editableFieldsTable input,
      #editableFieldsTable select,
      #editableFieldsTable2 input,
      #editableFieldsTable2 select,
      #editableFieldsTable3 input,
      #editableFieldsTable3 select {
        font-size: 11px;
      }

      /* Help popup m√≥vil peque√±o */
      .popup-overlay {
        padding: 10px;
      }
      
      .popup-container {
        max-width: 98vw;
        max-height: 90vh;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1 id="mainTitle" data-translate="title">Calculadora de Evoluci√≥n Digimon</h1>
	<p id="mainSubtitle" data-translate="subtitle">Creado por Rodrigoalag</p>
    <nav>
      <a href="./index.html">Main Hub</a>
      <a href="./calculadora.html">Digimon Evo Calc</a>
      <a href="./digimonreqs.html">Digimon Reqs</a>
      <a href="./StatRanking.html">Digimon Stat Ranking</a>
      <a href="./arbolevolutivo.html">Digimon Evolutive Tree</a>
	  <a href="./digidexprogress.html">Digidex Progress Checklist</a>
	  <a href="./BalanceCalculator.html">Balance Calculator</a>
      <a href="./Enemigosdelared.html">Enemigos de la Red</a>
      <a href="./dropsdelared.html">Drops de la Red</a>
      <a target="_blank" href="https://ndcalcs.github.io/">Carrow Website - General Info</a>
      <a target="_blank" href="https://whiterickle.neocities.org/Road%20To%20Perfect">WhiteRickle Website - Road To Perfect - Guides and Calculator</a>
      <a target="_blank" href="https://docs.google.com/spreadsheets/d/1WzSCjaje4apqByKV9HyXsLXEao92MoT07VQsNRqeAvI/edit?gid=1769528122#gid=1769528122">Driver Installation Guide</a>
      <a target="_blank" href="https://nd-lifespan-calculator-42a5ee.gitlab.io/">LifeSpan Calculator</a>
      <a target="_blank" href="https://nd-deck-builder-5188c6.gitlab.io/">Deck Builder</a>
    </nav>
	  <select id="languageSelector">
      <option value="es">Espa√±ol</option>
      <option value="en">English</option>
    </select>
  </header>
<section>
	<p id="disclaimer">
	  DISCLAIMER: Condiciones recopiladas basados en la experiencia del discord y screenshots. PUEDEN haber errores, en caso de encontrar alguno, contactarme en el discord de Net Driver haciendo ping a @rodrigoalag para revisar el caso.
	</p>
</section>

  <label for="digimonSelect" data-translate="selectDigimon">Selecciona las opciones:</label>
  <select id="digimonSelect"></select>
  
  <h3 id="digimonDataTitle" data-translate="digimonData">Datos del Digimon</h3>
  <table id="autoFieldsTable">
    <thead>
      <tr>
        <th data-translate="id">ID</th>
        <th data-translate="tama">Tama</th>
        <th data-translate="level">Nivel</th>
        <th data-translate="stage">Etapa</th>
        <th data-translate="attribute">Atributo</th>
        <th data-translate="type">Tipo</th>
      </tr>
    </thead>
    <tbody id="autoFields"></tbody>
  </table>
  
  <h3 id="fieldsToCompleteTitle" data-translate="fieldsToComplete">Campos a completar</h3>
  <div class="table-container" style="margin-bottom: 2px;">
    <table id="editableFieldsTable">
      <thead>
        <tr id="editableFieldsHeaders1"></tr>
      </thead>
      <tbody>
        <tr id="editableFields1"></tr>
      </tbody>
    </table>
  </div>

  <div class="table-container" style="margin-bottom: 2px;">
    <table id="editableFieldsTable2">
      <thead>
        <tr id="editableFieldsHeaders2"></tr>
      </thead>
      <tbody>
        <tr id="editableFields2"></tr>
      </tbody>
    </table>
  </div>

  <div class="table-container" style="margin-bottom: 10px;">
    <table id="editableFieldsTable3">
      <thead>
        <tr id="editableFieldsHeaders3"></tr>
      </thead>
      <tbody>
        <tr id="editableFields3"></tr>
      </tbody>
    </table>
  </div>
  
  <button id="calcularBtn" data-translate="calculate">Calcular evoluci√≥n</button>
  <p id="evolucionTexto" style="margin-top:15px; margin-bottom:15px; font-weight:bold; text-align:center;"></p>
  <div id="resultados"></div>
  <div id="resultadosCompletos"></div>

  <!-- Popup de ayuda para HP Base -->
  <div id="helpPopupOverlay" class="popup-overlay" onclick="closeHelpPopup(event)">
    <div class="popup-container">
      <button class="popup-close" onclick="closeHelpPopup()" aria-label="Cerrar">√ó</button>
      <img id="helpPopupImage" class="popup-image" src="" alt="Imagen de ayuda">
    </div>
  </div>

  <script>
  // ============================================
// FUNCIONES DEL POPUP DE AYUDA - SOLO A√ëADIDAS, SIN MODIFICAR C√ìDIGO EXISTENTE
// ============================================

// Configuraci√≥n de imagen de ayuda para HP Base
const helpImages = {
  hpbase: 'img/explicacionentrenamientobaseen.png' // ‚Üê Ruta de la imagen actualizada
};

// Funci√≥n para mostrar el popup
function showHelpPopup(helpKey) {
  const overlay = document.getElementById('helpPopupOverlay');
  const image = document.getElementById('helpPopupImage');
  
  // Configurar la imagen
  if (helpImages[helpKey]) {
    image.src = helpImages[helpKey];
    image.alt = `Ayuda para ${helpKey}`;
    
    // Mostrar el popup
    overlay.classList.add('show');
    
    // Prevenir scroll del body
    document.body.style.overflow = 'hidden';
    
    // Focus en el popup para accesibilidad
    overlay.focus();
  }
}

// Funci√≥n para cerrar el popup
function closeHelpPopup(event) {
  const overlay = document.getElementById('helpPopupOverlay');
  
  // Solo cerrar si se hace click en el overlay o en el bot√≥n de cerrar
  if (!event || event.target === overlay || event.target.classList.contains('popup-close')) {
    overlay.classList.remove('show');
    document.body.style.overflow = '';
    
    // Limpiar la imagen
    document.getElementById('helpPopupImage').src = '';
  }
}

// Cerrar popup con tecla Escape
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeHelpPopup();
  }
});

// Prevenir cierre accidental al hacer click en la imagen
document.addEventListener('DOMContentLoaded', function() {
  const container = document.querySelector('.popup-container');
  if (container) {
    container.addEventListener('click', function(event) {
      event.stopPropagation();
    });
  }

  // Manejar carga de imagen con error
  const helpImage = document.getElementById('helpPopupImage');
  if (helpImage) {
    helpImage.addEventListener('error', function() {
      this.alt = 'Error al cargar la imagen de ayuda';
      this.style.minHeight = '200px';
      this.style.display = 'flex';
      this.style.alignItems = 'center';
      this.style.justifyContent = 'center';
      this.style.backgroundColor = '#f0f0f0';
    });
  }

  // Touch events para mejor experiencia m√≥vil
  let touchStartY = 0;
  const overlay = document.getElementById('helpPopupOverlay');
  if (overlay) {
    overlay.addEventListener('touchstart', function(e) {
      touchStartY = e.touches[0].clientY;
    });

    overlay.addEventListener('touchend', function(e) {
      const touchEndY = e.changedTouches[0].clientY;
      const deltaY = touchEndY - touchStartY;
      
      // Si desliza hacia abajo m√°s de 50px, cerrar popup
      if (deltaY > 50) {
        closeHelpPopup();
      }
    });
  }
});

// ‚úÖ FUNCI√ìN PARA AGREGAR EL HELP ICON AL HP BASE CUANDO SE CREE LA TABLA
function addHelpIconToHPBase() {
  // Esperar un poco y buscar el header de HP Base en todas las tablas
  setTimeout(() => {
    const headersRows = [
      document.getElementById('editableFieldsHeaders1'),
      document.getElementById('editableFieldsHeaders2'),
      document.getElementById('editableFieldsHeaders3')
    ];

    headersRows.forEach(headersRow => {
      if (!headersRow) return;

      Array.from(headersRow.children).forEach(header => {
        const headerText = header.textContent.trim();

        // Buscar HP Base en cualquier idioma y agregar help icon si no lo tiene
        if ((headerText === 'HP Base' || headerText.includes('HP Base')) && !header.querySelector('.help-icon')) {
          const helpIcon = document.createElement('span');
          helpIcon.className = 'help-icon';
          helpIcon.onclick = () => showHelpPopup('hpbase');
          helpIcon.title = 'Ver ayuda / Show help';
          helpIcon.textContent = '?';
          helpIcon.setAttribute('aria-label', 'Ver ayuda');

          // Agregar el icono al header
          header.appendChild(document.createTextNode(' '));
          header.appendChild(helpIcon);
        }
      });
    });
  }, 500); // Dar tiempo suficiente para que se cree la tabla
}

// Observador para detectar cuando se crea/modifica la tabla
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
      // Verificar si se agregaron headers a cualquiera de las tablas
      const headersRows = [
        document.getElementById('editableFieldsHeaders1'),
        document.getElementById('editableFieldsHeaders2'),
        document.getElementById('editableFieldsHeaders3')
      ];

      headersRows.forEach(headersRow => {
        if (headersRow && headersRow.children.length > 0) {
          addHelpIconToHPBase();
        }
      });
    }
  });
});

// Observar cambios en la tabla
document.addEventListener('DOMContentLoaded', () => {
  const tableContainer = document.querySelector('.table-container');
  if (tableContainer) {
    observer.observe(tableContainer, {
      childList: true,
      subtree: true
    });
  }
  
  // Tambi√©n intentar agregar el icono inmediatamente por si la tabla ya existe
  addHelpIconToHPBase();
});

// ============================================
// SISTEMA DE TRADUCCIONES ORIGINAL - SIN MODIFICACIONES
// ============================================

// Diccionario de traducciones
const translations = {
  es: {
    // Textos de interfaz
    title: "Calculadora de Evoluci√≥n Digimon",
    subtitle: "Creado por Rodrigoalag",
    selectDigimon: "Selecciona las opciones:",
    digimonData: "Datos del Digimon",
    fieldsToComplete: "Campos a completar",
    calculate: "Calcular evoluci√≥n",
    disclaimer: "DISCLAIMER: Condiciones recopiladas basados en la experiencia del discord y screenshots. PUEDEN haber errores, en caso de encontrar alguno, contactarme en el discord de Net Driver haciendo ping a @rodrigoalag para revisar el caso.",
    // Headers de tabla
    id: "ID",
    tama: "Tama",
    level: "Nivel",
    stage: "Etapa",
    attribute: "Atributo",
    type: "Tipo",
    // Campos editables comunes
    peso: "Peso",
    errores: "Errores de Crianza",
	induceddeath: "Muerte inducida sin Carne X o Program",
    entrenamiento: "% Entrenamiento",
    vinculo: "V√≠nculo m√°ximo alcanzado",
	vinculo2: "Vinculo al momento de evolucionar",
	entrenos25: "Menos de 15 entrenamientos?",
    batallas: "Batallas",
    winRate: "WinRate",
    entrenamientopregunta: '¬øRealiz√≥ Entrenamiento?',
    statsuperior: 'Stat Superior',
    agumon06: '¬øObtuviste dos perfect en las ultimas dos generaciones/Obtuviste antes a Agumon 06?',
    driverequip: 'Driver Equipado',
    victorias: 'Victorias',
    bonusvictorias: 'Bonus Victorias Minimas',
    bonus: 'Bonus',
    // Opciones de selects
    si: "S√≠",
    no: "No",
    Balanceado: "Balanceado",
    Ninguno: "Ninguno",
    Compuesto: "Compuesto", 
    Dinosaurio: "Dinosaurio",
    Vacuna: "Vacuna",
    Maquina: "Maquina",
    Tierra: "Tierra",
    Hielo: "Hielo",
    Mutante: "Mutante",
    caca: "5 Caca",
    sardina: "5 Sardinas",
    bellotad: "Bellota Dorada",
    verduracongelada: "Verdura Congelada como ultima comida antes de la evolucion",
    hongocongelado: "Hongo Congelado como ultima comida antes de la evolucion",
    Chatarra: "Chatarra",
    insekilow: "Starmon o ShootingStarmon Driver",
    insekimid: "SuperStarmon o DarkSuperStarmon Driver",
    insekihigh: "SuperStarmon y DarkSuperStarmon Driver",
    selecciona: "--Selecciona--",
    puntaje: "Puntaje Total",
    program: "Program",
    xross: "Xross o Install",
    etapa: "Etapa",
    digimon: "Digimon",
    gigawaruxross: "3 Monzaemon Driver en WaruMonzaemon o 3 WaruMonzaemon Driver en Monzaemon",
    comida: "Comida",
    vnegativo: "Alcanzo vinculo negativo?",
	trainedhp: "HP %",
	trainedatk: "ATK %",
	trainedspd: "SPD %"
  },
  en: {
    // Interface texts
    title: "Digimon Evolution Calculator",
    subtitle: "Created by Rodrigoalag",
    selectDigimon: "Select your options:",
    digimonData: "Digimon Data",
    fieldsToComplete: "Fields to Complete",
    calculate: "Calculate evolution",
    disclaimer:"DISCLAIMER: Conditions based on the user experience of the discord and screenshots. There can be errors or mistakes, in case of finding one, please contact me at Net Driver discord by pinging @rodrigoalag to check the case.",
    // Table headers
    id: "ID",
    tama: "Tama",
    level: "Level",
    stage: "Stage",
    attribute: "Attribute",
    type: "Type",
    // Common editable fields
    peso: "Weight",
    errores: "Care Mistakes",
    entrenamiento: "% Training",
    vinculo: "Max Bond Achieved",
	induceddeath: "Induced death without Meat X or Death Program",
	vinculo2: "Bond at evolution",
	entrenos25: "Less than 15 trainings?",
    batallas: "Battles",
    winRate: "WinRate",
    entrenamientopregunta: 'Did you make a training?',
    statsuperior: 'Superior Stat',
    agumon06: 'Did you have 2 perfects on last two generations/Did you obtain Agumon 06?',
    driverequip: 'Driver equipped',
    victorias: 'Victories',
    bonusvictorias: 'Minimum Victory Bonus',
    bonus: 'Bonus',
    // Select options
    si: "Yes",
    no: "No",
    Balanceado: "Balanced",
    Ninguno: "None",
    Compuesto: "Composite", 
    Dinosaurio: "Dinosaur",
    Vacuna: "Vaccine",
    Maquina: "Machine",
    Hielo: "Ice",
    Mutante: "Mutant",
    Tierra: "Earth",
    caca: "5 Poop",
    sardina: "5 DigiSardine",
    bellotad: "Golden Acorn",
    verduracongelada: "Frozen Vegetable as last food eaten before evolving.",
    hongocongelado: "Frozen Mushroom as last food eaten before evolving.",
    Chatarra: "Metal Scrap",
    insekilow: "Starmon or ShootingStarmon Driver",
    insekimid: "SuperStarmon or DarkSuperStarmon Driver",
    insekihigh: "SuperStarmon and DarkSuperStarmon Driver",
    selecciona: "--Select--",
    puntaje: "Total Points",
    program: "Program",
    xross: "Xross or Install",
    etapa: "Stage",
    digimon: "Digimon",
    gigawaruxross: "3 Monzaemon Driver in WaruMonzaemon or 3 WaruMonzaemon Driver in Monzaemon",
    comida:"Food",
    vnegativo: "Reached negative bond?",
	trainedhp: "HP %",
	trainedatk: "ATK %",
	trainedspd: "SPD %"
  }
};

// Variable para idioma actual
let currentLanguage = 'es';

// ‚úÖ NUEVA FUNCI√ìN: Detectar idioma autom√°ticamente
function detectLanguage() {
  // Logger 1: Ver el valor del atributo lang del HTML
  const htmlLangElement = document.getElementById('htmlLang');
  const htmlLangValue = document.documentElement.getAttribute('lang') || htmlLangElement?.getAttribute('lang');
  console.log('üîç HTML Lang detectado:', htmlLangValue);
  
  // 1. Verificar si hay un idioma guardado (ahora desde HTML)
  const savedLanguage = document.documentElement.getAttribute('lang') || document.getElementById('htmlLang')?.getAttribute('lang');
  
  // Logger 2: Ver el savedLanguage que se est√° usando
  console.log('üíæ Saved Language obtenido:', savedLanguage);
  
  if (savedLanguage && translations[savedLanguage]) {
    console.log('‚úÖ Usando idioma guardado:', savedLanguage);
    return savedLanguage;
  }
  
  // 2. Detectar idioma del navegador
  const browserLanguage = navigator.language || navigator.userLanguage;
  const languageCode = browserLanguage.split('-')[0].toLowerCase();
  console.log('üåê Idioma del navegador:', languageCode);
  
  // 3. Verificar si el idioma del navegador est√° soportado
  if (translations[languageCode]) {
    console.log('‚úÖ Usando idioma del navegador:', languageCode);
    return languageCode;
  }
  
  // 4. Fallback a espa√±ol por defecto
  console.log('‚ö†Ô∏è Usando fallback a espa√±ol');
  return 'es';
}

// Funci√≥n para traducir texto
function translate(key, lang = currentLanguage) {
  return translations[lang] && translations[lang][key] ? translations[lang][key] : key;
}

// Funci√≥n para actualizar interfaz cuando cambie idioma
function updateInterfaceLanguage() {
  // Actualizar t√≠tulo de p√°gina
  document.title = translate('title');
  const pageTitle = document.getElementById('pageTitle');
  if (pageTitle) {
    pageTitle.textContent = translate('title');
  }
  
  // Actualizar p√°rrafo de disclaimer
  const disclaimer = document.getElementById('disclaimer');
  if (disclaimer) {
    disclaimer.textContent = translate('disclaimer');
  }
  
  // Actualizar elementos con data-translate
  document.querySelectorAll('[data-translate]').forEach(element => {
    const key = element.getAttribute('data-translate');

    // Caso especial para el t√≠tulo de datos del Digimon
    if (element.id === 'digimonDataTitle') {
      const digimonSelect = document.getElementById('digimonSelect');
      if (digimonSelect && digimonSelect.value && digimonSelect.value !== '') {
        // Mantener el nombre del Digimon seleccionado
        const titlePrefix = currentLanguage === 'es' ? 'Datos de' : 'Data of';
        element.textContent = `${titlePrefix} ${digimonSelect.value}`;
      } else {
        // Usar la traducci√≥n por defecto si no hay Digimon seleccionado
        element.textContent = translate(key);
      }
    } else {
      element.textContent = translate(key);
    }
  });
  
  // Actualizar headers de tablas
  updateTableHeaders();
  
  // Actualizar campos din√°micos si existen
  updateEditableFieldsHeaders();
  
  // Traducir opciones de todos los selects
  const selects = document.querySelectorAll('#editableFields select');
  selects.forEach(select => translateSelectOptions(select));
  
  // Traducir contenido de tabla de datos del Digimon
  translateAutoFieldsContent();
  
  // Actualizar atributo lang del HTML
  const htmlLang = document.getElementById('htmlLang');
  if (htmlLang) {
    htmlLang.setAttribute('lang', currentLanguage);
  }
  
  // ‚úÖ NUEVO: Actualizar el selector de idioma sin disparar el evento
  const languageSelector = document.getElementById('languageSelector');
  if (languageSelector && languageSelector.value !== currentLanguage) {
    languageSelector.value = currentLanguage;
  }
}

function updateTableHeaders() {
  // Headers de la tabla de autoFields
  const autoHeaders = document.querySelectorAll('#autoFieldsTable th[data-translate]');
  autoHeaders.forEach(header => {
    const key = header.getAttribute('data-translate');
    header.textContent = translate(key);
  });

  // Headers de la tabla de resultados
  const resultadosHeaders = document.querySelectorAll('#resultados th[data-translate]');
  resultadosHeaders.forEach(header => {
    const key = header.getAttribute('data-translate');
    header.textContent = translate(key);
  });
}

function updateEditableFieldsHeaders() {
  const headersRows = [
    document.getElementById('editableFieldsHeaders1'),
    document.getElementById('editableFieldsHeaders2'),
    document.getElementById('editableFieldsHeaders3')
  ];
  const resultados = document.getElementById('resultados');

  // Mapeo de textos en espa√±ol a claves de traducci√≥n
  const headerMapping = {
    'Peso': 'peso',
    'Weight': 'peso',
    'Errores': 'errores',
    'Errors': 'errores',
	'Muerte inducida sin Carne X o Program (30% de salir)': 'induceddeath',
    'Induced death without Meat X or Death Program (30% Chance)': 'induceddeath',
    'Muerte inducida sin Carne X o Program': 'induceddeath',
    'Induced death without Meat X or Death Program': 'induceddeath',
    '% Entrenamiento': 'entrenamiento',
    '% Training': 'entrenamiento',
    'V√≠nculo m√°ximo alcanzado': 'vinculo',
	'Vinculo Maximo Alcanzado': 'vinculo',
	'Alcanzo vinculo negativo?':'vnegativo',
    'Vinculo': 'vinculo',
	'Vinculo al momento de evolucionar':'vinculo2',
	'Bond at evolution':'vinculo2',
	'Bonus Vinculo al momento de evolucionar':'vinculo2',
	"Menos de 15 entrenamientos?": "entrenos25",
	"Less than 15 trainings?": "entrenos25",
    'Max Bond Achieved': 'vinculo',
    'Batallas': 'batallas',
    'Battles': 'batallas',
    'WinRate': 'winRate',
    '¬øRealiz√≥ Entrenamiento?': 'entrenamientopregunta',
    'Did you make a training?': 'entrenamientopregunta',
    'Stat Superior': 'statsuperior',
    'Superior Stat': 'statsuperior',
    '¬øObtuviste dos perfect en las ultimas dos generaciones/Obtuviste antes a Agumon 06?': 'agumon06',
    'Did you have 2 perfects on last two generations/Did you obtain Agumon 06?': 'agumon06',
    'Driver Equipado': 'driverequip',
    'Driver equipped': 'driverequip',
    'Victorias': 'victorias',
    'Victories': 'victorias',
    'Bonus Victorias Minimas': 'bonusvictorias',
    'Minimum Victory Bonus': 'bonusvictorias',
    'Puntaje Total': 'puntaje',
    'Total Points': 'puntaje',
    'Etapa': 'etapa',
    'Stage': 'etapa',
    'Digimon': 'digimon',
    'Program': 'program',
    'Bonus': 'bonus',
    'Xross': 'xross',
    'Comida':'comida',
    'Food': 'comida',
	"HP Entrenado":'trainedhp',
	"HP %":'trainedhp',
	"Trained HP":'trainedhp',
    "ATK Entrenado":'trainedatk',
    "ATK %":'trainedatk',
    "Trained ATK":'trainedatk',
    "SPD Entrenado":'trainedspd',
    "SPD %":'trainedspd',
    "Trained SPD":'trainedspd'
  };

  // Traducir encabezados en todas las filas
  headersRows.forEach(headersRow => {
    if (headersRow) {
      Array.from(headersRow.children).forEach(header => {
        const currentText = header.textContent.trim();
        const translationKey = headerMapping[currentText];
        if (translationKey) {
          header.textContent = translate(translationKey);
        }
      });
    }
  });

  // Traducir texto del elemento 'resultados' si es texto simple
  if (resultados) {
    const text = resultados.textContent.trim();
    const translationKey = headerMapping[text];
    if (translationKey) {
      resultados.textContent = translate(translationKey);
    }
  }
}

function translateSelectOptions(select) {
  if (!select) return;

  Array.from(select.options).forEach(option => {
    const text = option.textContent.trim().toLowerCase();

    // Mapear posibles textos (espa√±ol e ingl√©s) a claves del diccionario
    const matchTable = {
      's√≠': 'si',
      'si': 'si',
      'yes': 'si',
      'no': 'no',
      'balanceado': 'Balanceado',
      'balanced': 'Balanceado',
      'ninguno': 'Ninguno',
      'none': 'Ninguno',
      'compuesto': 'Compuesto',
      'composite': 'Compuesto',
      'dinosaurio': 'Dinosaurio',
      'dinosaur': 'Dinosaurio',
      'vacuna': 'Vacuna',
      'vaccine': 'Vacuna',
      'maquina': 'Maquina',
      'machine': 'Maquina',
      'hielo': 'Hielo',
      'ice': 'Hielo',
      'mutante': 'Mutante',
      'mutant': 'Mutante',
      'tierra': 'Tierra',
      'earth': 'Tierra',
      '5 Caca': 'caca',
      '5 poop': 'caca',
      '5 sardinas': 'sardina',
      '5 digisardine': 'sardina',
      'bellota dorada': 'bellotad',
      'golden acorn': 'bellotad',
	 'verdura congelada': 'verduracongelada',
	  'verdura congelada como ultima comida antes de la evolucion': 'verduracongelada',
	  'frozen vegetable as last food eaten before evolving.': 'verduracongelada',
	  'hongo congelado': 'hongocongelado',
	  'hongo congelado como ultima comida antes de la evolucion': 'hongocongelado',
	  'frozen mushroom as last food eaten before evolving.': 'hongocongelado',
      'chatarra': 'Chatarra',
      'metal scrap': 'Chatarra',
      'starmon o shootingstarmon driver': 'insekilow',
      'starmon or shootingstarmon driver': 'insekilow',
      'superstarmon o darksuperstarmon driver': 'insekimid',
      'superstarmon or darksuperstarmon driver': 'insekimid',
      'superstarmon y darksuperstarmon driver': 'insekihigh',
      'superstarmon and darksuperstarmon driver': 'insekihigh',
      '--selecciona--': 'selecciona',
      '--select--': 'selecciona',
      '3 monzaemon driver en warumonzaemon o 3 warumonzaemon driver en monzaemon': 'gigawaruxross',
      '3 monzaemon driver in warumonzaemon or 3 warumonzaemon driver in monzaemon': 'gigawaruxross'
    };

    const key = matchTable[text];
    if (key) {
      option.textContent = translate(key);
    }
  });
}


function translateAutoFieldsContent() {
  const autoFields = document.getElementById('autoFields');
  if (!autoFields) return;

  const cells = autoFields.querySelectorAll('td');
  cells.forEach(cell => {
    const rawText = cell.textContent.trim();
    const key = Object.keys(translations[currentLanguage]).find(k => k.toLowerCase() === rawText.toLowerCase());

    if (key) {
      cell.textContent = translate(key);
    }
  });
}

function translateresultadosContent() {
  const resultados = document.getElementById('resultados');
  if (!resultados) return;

  const cells = resultados.querySelectorAll('th');
  cells.forEach(cell => {
    const rawText = cell.textContent.trim();
    const key = Object.keys(translations[currentLanguage]).find(k => k.toLowerCase() === rawText.toLowerCase());

    if (key) {
      cell.textContent = translate(key);
    }
  });
}

// Funci√≥n para reorganizar campos con dropdowns a la derecha
function reorganizeFields() {
  const originalScript = document.createElement('script');
  originalScript.src = 'script.js';

  originalScript.onload = function() {
    const retryInterval = setInterval(() => {
      if (typeof window.populateEditableFields === 'function') {
        const originalPopulateEditableFields = window.populateEditableFields;

        window.populateEditableFields = function(digimon) {
          originalPopulateEditableFields(digimon);

          setTimeout(() => {
            reorganizeTableColumns();
            updateEditableFieldsHeaders();

            const selects = document.querySelectorAll('#editableFields select');
            selects.forEach(select => translateSelectOptions(select));

            updateInterfaceLanguage();
            
            // ‚úÖ Agregar help icon despu√©s de reorganizar y actualizar estilos
            setTimeout(() => {
              addHelpIconToHPBase();
            }, 200);
          }, 150);
        };

        clearInterval(retryInterval);
      }
    }, 50);
  };

  document.head.appendChild(originalScript);
}

function reorganizeTableColumns() {
  // Esta funci√≥n ya no se usa, la distribuci√≥n en 3 tablas se maneja en script.js
  return;
}

function updateColumnStyles() {
  // Esta funci√≥n ya no se usa, los estilos se manejan con CSS est√°tico
  return;
}

function observarSelectsDinamicos() {
  const targets = [
    document.getElementById('editableFields1'),
    document.getElementById('editableFields2'),
    document.getElementById('editableFields3')
  ];

  targets.forEach(target => {
    if (!target) return;

    const observer = new MutationObserver((mutationsList, observer) => {
      let changed = false;

      for (const mutation of mutationsList) {
        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
          changed = true;
        }
      }

      if (changed) {
        const selects = target.querySelectorAll('select:not([data-translated])');
        selects.forEach(select => {
          translateSelectOptions(select);
          select.setAttribute('data-translated', 'true');
        });
      }
    });

    observer.observe(target, { childList: true, subtree: true });
  });
}

// ‚úÖ MODIFICADO: Event listener mejorado para inicializaci√≥n autom√°tica
document.addEventListener('DOMContentLoaded', function() {
  // 1. Detectar idioma autom√°ticamente
  currentLanguage = detectLanguage();
  
  // 2. Configurar el selector de idioma
  const languageSelector = document.getElementById('languageSelector');
  if (languageSelector) {
    languageSelector.value = currentLanguage;
    
    languageSelector.addEventListener('change', function() {
      currentLanguage = this.value;
      localStorage.setItem('digilang', currentLanguage);
      updateInterfaceLanguage();
    });
  }
  
  // 3. Aplicar traducci√≥n autom√°ticamente
  updateInterfaceLanguage();
  
  // 4. Guardar el idioma detectado
  localStorage.setItem('digilang', currentLanguage);
  
  // 5. Inicializar reorganizaci√≥n de campos
  reorganizeFields();
  
  // 6. A√±adir observador para detectar cambios y traducir selects nuevos
  observarSelectsDinamicos();
});

// ‚úÖ NUEVO: Funci√≥n para forzar actualizaci√≥n de traducciones cuando sea necesario
window.forceTranslationUpdate = function() {
  updateInterfaceLanguage();
};

// ‚úÖ NUEVO: Funci√≥n espec√≠fica para traducir elementos din√°micos sin bucles
window.translateNewElements = function(container) {
  if (!container) return;
  
  const elementsToTranslate = container.querySelectorAll('[data-translate]');
  elementsToTranslate.forEach(element => {
    const key = element.getAttribute('data-translate');
    element.textContent = translate(key);
  });
  
  const selects = container.querySelectorAll('select');
  selects.forEach(select => translateSelectOptions(select));
};

  </script>
  <script src="digimonReqDict.js"></script>
  <script src="digimonstattier.js"></script>

</body>
</html>